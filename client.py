import requests
import time

# send tx
url = "http://127.0.0.1:4000/api/eth-test/send_tx"

headers = {"Content-Type": "application/json", "key": "auto_tx_test"}

json = {
    "user_code": "1",
    "to": "0x1879C8B68c50A4D4eeC9852325d32B60B43f3FbD",
    "data": "0xabcd1234",
    # 'data': '60806040523480156200001157600080fd5b5060005b60018110156200007c5760006200004060018362000034919062000285565b6200008360201b60201c565b908060018154018082558091505060019003906000526020600020016000909190919091505580806200007390620002f0565b91505062000015565b50620003d4565b60008082905060005b600181101562000106578082620000a49190620001f0565b9150600282620000b5919062000285565b9150600382620000c69190620001f0565b9150600282189150600582620000dd91906200024d565b9150606182620000ee91906200033e565b91508080620000fd90620002f0565b9150506200008c565b506200011960326200014160201b60201c565b6200012a826200018760201b60201c565b620001369190620001f0565b905080915050919050565b600080600190506000600190505b8381116200017d57808262000165919062000285565b915080806200017490620002f0565b9150506200014f565b5080915050919050565b60008060026001846200019b9190620001f0565b620001a791906200024d565b90508291505b81811015620001ea578091506002818285620001ca91906200024d565b620001d69190620001f0565b620001e291906200024d565b9050620001ad565b50919050565b6000620001fd82620002e6565b91506200020a83620002e6565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0382111562000242576200024162000376565b5b828201905092915050565b60006200025a82620002e6565b91506200026783620002e6565b9250826200027a5762000279620003a5565b5b828204905092915050565b60006200029282620002e6565b91506200029f83620002e6565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0483118215151615620002db57620002da62000376565b5b828202905092915050565b6000819050919050565b6000620002fd82620002e6565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82141562000333576200033262000376565b5b600182019050919050565b60006200034b82620002e6565b91506200035883620002e6565b9250826200036b576200036a620003a5565b5b828206905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b6106c080620003e46000396000f3fe608060405234801561001057600080fd5b50600436106100575760003560e01c80632cc27dc71461005c578063434cb6b21461008c5780637b019f891461009657806383714834146100c6578063d42a1aa6146100f6575b600080fd5b6100766004803603810190610071919061045d565b610126565b6040516100839190610495565b60405180910390f35b6100946101c4565b005b6100b060048036038101906100ab919061045d565b610387565b6040516100bd9190610495565b60405180910390f35b6100e060048036038101906100db919061045d565b6103e4565b6040516100ed9190610495565b60405180910390f35b610110600480360381019061010b919061045d565b610424565b60405161011d9190610495565b60405180910390f35b60008082905060005b600181101561019b57808261014491906104b0565b91506002826101539190610537565b915060038261016291906104b0565b91506002821891506005826101779190610506565b915060618261018691906105e4565b915080806101939061059b565b91505061012f565b506101a660326103e4565b6101af82610387565b6101b991906104b0565b905080915050919050565b60005b600080549050811015610384576000600260008381548110610212577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b906000526020600020015461022791906105e4565b14156102cb57600260008281548110610269577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b906000526020600020015461027e9190610506565b600082815481106102b8577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b9060005260206000200181905550610371565b6001600360008381548110610309577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b906000526020600020015461031e9190610537565b61032891906104b0565b60008281548110610362577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b90600052602060002001819055505b808061037c9061059b565b9150506101c7565b50565b600080600260018461039991906104b0565b6103a39190610506565b90508291505b818110156103de5780915060028182856103c39190610506565b6103cd91906104b0565b6103d79190610506565b90506103a9565b50919050565b600080600190506000600190505b83811161041a5780826104059190610537565b915080806104129061059b565b9150506103f2565b5080915050919050565b6000818154811061043457600080fd5b906000526020600020016000915090505481565b60008135905061045781610673565b92915050565b60006020828403121561046f57600080fd5b600061047d84828501610448565b91505092915050565b61048f81610591565b82525050565b60006020820190506104aa6000830184610486565b92915050565b60006104bb82610591565b91506104c683610591565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156104fb576104fa610615565b5b828201905092915050565b600061051182610591565b915061051c83610591565b92508261052c5761052b610644565b5b828204905092915050565b600061054282610591565b915061054d83610591565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff048311821515161561058657610585610615565b5b828202905092915050565b6000819050919050565b60006105a682610591565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8214156105d9576105d8610615565b5b600182019050919050565b60006105ef82610591565b91506105fa83610591565b92508261060a57610609610644565b5b828206905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b61067c81610591565b811461068757600080fd5b5056fea2646970667358221220b8d1b6b8066fffaf02201396e93196418a6ca3775b71907d9122dbd7a9d6881764736f6c63430008000033',
}

resp = requests.post(url, json=json, headers=headers).json()

if "data" not in resp:
    print(f"send failed, resp: {resp}")
    exit(1)

hash = resp["data"]["hash"]

print(f"send success, hash: {hash}")

time.sleep(10)

# get onchain hash
url = "http://127.0.0.1:4000/api/get_onchain_hash"

response = requests.post(url, json={"user_code": "1"}, headers=headers)

print(f"onchain_hash: {response.text}")
